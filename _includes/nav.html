<header class="site-header" role="banner">
  <nav class="nav" role="navigation" aria-label="Main">
    <a class="nav__brand" href="{{ '/' | relative_url }}">
      <span class="nav__brand-mark" aria-hidden="true"></span>
      <span class="nav__brand-text">{{ site.title }}</span>
    </a>

    <button class="nav__toggle" type="button"
            aria-label="Open menu"
            aria-controls="primary-nav"
            aria-expanded="false">
      <span aria-hidden="true" class="nav__icon"></span>
    </button>

    <ul id="primary-nav" class="nav__links" hidden>
      <!-- Homepage sections (works from any page) -->
      <li><a href="{{ '/' | relative_url }}#offer">Offer</a></li>
      <li><a href="{{ '/' | relative_url }}#process">Process</a></li>
      <li><a href="{{ '/' | relative_url }}#pricing">Pricing</a></li>
      <li><a href="{{ '/' | relative_url }}#faq">FAQs</a></li>
      <li><a href="{{ '/' | relative_url }}#contact">Contact</a></li>

      <li class="nav__sep" aria-hidden="true"></li>

      <!-- Real pages -->
      <li><a href="{{ '/blog/' | relative_url }}">Blog</a></li>
      <li><a href="{{ '/self-discovery/' | relative_url }}">Self-Discovery</a></li>
    </ul>
  </nav>
</header>

<script>
  (function () {
    const header = document.currentScript.previousElementSibling; // <header>
    const btn = header.querySelector('.nav__toggle');
    const list = header.querySelector('#primary-nav');

    if (!btn || !list) return;

    const mqDesktop = window.matchMedia('(min-width: 861px)');

    function setOpen(open) {
      btn.setAttribute('aria-expanded', String(open));
      btn.setAttribute('aria-label', open ? 'Close menu' : 'Open menu');
      if (open) list.removeAttribute('hidden');
      else list.setAttribute('hidden', '');
    }

    function syncForBreakpoint() {
      // Desktop: ALWAYS show links
      if (mqDesktop.matches) {
        btn.setAttribute('aria-expanded', 'false');
        btn.setAttribute('aria-label', 'Open menu');
        list.removeAttribute('hidden');
        return;
      }
      // Mobile: closed by default
      setOpen(false);
    }

    // Initial state
    syncForBreakpoint();

    // Toggle (mobile)
    btn.addEventListener('click', (e) => {
      if (mqDesktop.matches) return;
      e.stopPropagation();
      const open = btn.getAttribute('aria-expanded') !== 'true';
      setOpen(open);
    });

    // Close when a link is chosen (mobile)
    list.addEventListener('click', (e) => {
      if (mqDesktop.matches) return;
      if (e.target && e.target.tagName === 'A') setOpen(false);
    });

    // Close on Escape (mobile)
    document.addEventListener('keydown', (e) => {
      if (mqDesktop.matches) return;
      if (e.key === 'Escape') setOpen(false);
    });

    // Close when clicking outside (mobile)
    document.addEventListener('click', (e) => {
      if (mqDesktop.matches) return;
      const isOpen = btn.getAttribute('aria-expanded') === 'true';
      if (!isOpen) return;
      if (!header.contains(e.target)) setOpen(false);
    });

    // React to breakpoint changes
    mqDesktop.addEventListener?.('change', syncForBreakpoint);
    window.addEventListener('resize', syncForBreakpoint);
  })();
</script>